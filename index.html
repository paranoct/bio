<!DOCTYPE html> 
<html lang="ru">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Paranoct — bio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- ========== 추가: монетки, счетчик и колесо фортуны ========== -->
<style>
  /* контейнер для счётчика монет — чуть прозрачный, над кнопками */
  #coinCounter {
    position: fixed;
    right: 154px;
    bottom: 18px;
    z-index: 10002;
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.04);
    padding: 8px 10px;
    border-radius: 10px;
    color: var(--deep-blue-strong);
    font-weight: 700;
    pointer-events: auto;
    opacity: 0.92; /* чуть прозрачный */
    backdrop-filter: blur(4px);
  }
  #coinCounter i{font-size:16px}
  #coinCounter span{min-width:28px; text-align:right; display:inline-block}
  
  /* wheel open button (styled like social-link) */
  #wheelBtn {
    position: fixed;
    right: 86px;
    bottom: 18px;
    z-index: 10002;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.04);
    color: var(--deep-blue-strong);
    cursor: pointer;
    transition: transform .18s ease, background .18s ease, color .18s ease;
    pointer-events: auto;
  }
  #wheelBtn:hover{ transform: translateY(-6px); background: rgba(64,116,130,0.07); color: var(--soft-blue); }

  /* coin visuals — чуть прозрачная и кликабельная */
  .coin {
    position: fixed;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fff5c4 0%, #ffd24d 20%, #f2b10b 60%, #a87500 100%);
    box-shadow: 0 6px 18px rgba(0,0,0,0.45), inset 0 -6px 8px rgba(0,0,0,0.12);
    z-index: 10001;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    color:#6a4300;
    cursor:pointer;
    transform-origin: center;
    transition: transform .22s cubic-bezier(.2,.9,.3,1), opacity .22s;
    opacity: 0.72; /* чуть прозрачная */
    pointer-events: auto;
  }
  .coin.spawn-anim { animation: floatUp 1.2s ease both; }
  @keyframes floatUp {
    0% { transform: translateY(-10px) scale(0.8); opacity: 0; }
    60% { transform: translateY(6px) scale(1.06); opacity: 1; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
  }

  /* wheel overlay */
  #wheelOverlay {
    position: fixed;
    inset: 0;
    z-index: 10003;
    background: rgba(0,0,0,0.55);
    display: none;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
  }
  #wheelOverlay.open { display:flex; }

  .wheelModal {
    width: 520px;
    max-width: calc(100% - 40px);
    background: linear-gradient(180deg, rgba(18,22,24,0.96), rgba(10,12,14,0.96));
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.04);
    color: var(--deep-blue-strong);
    text-align: center;
  }
  .wheelWrap { display:flex; gap:14px; align-items:center; justify-content:center; flex-direction:column; }

  /* wheel element */
  #wheel {
    width: 340px;
    height: 340px;
    border-radius: 50%;
    background: conic-gradient(
      #f3c66b 0deg 90deg,
      #e59e6b 90deg 180deg,
      #027014 180deg 270deg,
      #8d5353 270deg 360deg
    );
    position: relative;
    transition: transform 5s cubic-bezier(.14,.9,.36,1);
    box-shadow: inset 0 8px 36px rgba(0,0,0,0.35), 0 18px 40px rgba(0,0,0,0.6);
    user-select: none;
  }
  /* arrow pointer — сверху */
  .wheelPointer {
    width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:22px solid #ffd87a;
    position: absolute; top: 260px; left:50%-0; transform:translateX(-50%), rotate(180deg); z-index:2; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.4));
    pointer-events:none;
  }
  .wheel-controls { display:flex; gap:10px; margin-top:12px; align-items:center; justify-content:center; }

  .btn-ghost{
    padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);color:var(--deep-blue-strong);cursor:pointer;
  }

  /* добавлены hover/active эффекты для кнопки Крутить */
  .btn-primary{
    padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,#4a8ba3,#3f7486);color:#021;cursor:pointer;border:none;font-weight:700;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  }
  .btn-primary:hover{
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.45);
    opacity: 0.98;
  }
  .btn-primary:active{
    transform: translateY(-1px) scale(0.98);
  }
  .btn-primary[disabled]{
    opacity:0.5;
    transform:none;
    cursor: default;
    box-shadow:none;
  }

  #wheelResult { margin-top:10px; min-height:22px; color: #dfefff; font-weight:700; }

  /* small mobile adjustments */
  @media(max-width:600px){
    #coinCounter { right: 12px; bottom: 74px; }
    #wheelBtn { right: 64px; bottom: 18px; }
  }
    :root{ --bg-black:#000; --deep-blue:#4a8ba3; --deep-blue-strong:#a9e6f7; --soft-blue:#3f7486; --blur:16px }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg-black);color:var(--deep-blue-strong);font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;overflow-x:hidden;position:relative}

    /* lamp: полностью видимая фотография, стоящая правее и ниже (как будто на земле) */
    .lamp{
      position:fixed;
      right:80%;        /* сдвинуто вправо — при необходимости поменяй */
      top:95%;       /* стоит на "земле" — при необходимости поменяй */
      width:520px;
      height:520px;  /*  4part of flag in /secret/4part.html  */
      z-index:0;       /* позади основной карточки */
      pointer-events:none;
      background-image: url('1'); /* путь к твоему локальному изображению */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: 50% 100%; /* центр по горизонтали, низ по вертикали */
      opacity:0.27;       /* полностью непрозрачная */
      mix-blend-mode: normal;
      filter: contrast(0.98) brightness(0.7) saturate(0.98);
      transform-origin:center bottom;
      will-change:transform,opacity,filter;
    }

    /* добавленная фоновая картинка страницы (локальная, полупрозрачная) */
    .page-bg{
      position:fixed;
      inset:0;
      z-index:-2; /* за всем остальным */
      pointer-events:none;
      background-image: url('fon.jpg'); /* если фон лежит рядом с html — оставь так, иначе укажи полный путь */
      background-size: cover;
      background-position: center center;
      opacity: 0.3; /* чуть-чуть прозрачная — поменяй, если нужно */
      filter: brightness(0.7) saturate(0.95);
    }

    /* ореол — над фотографией, но под UI; изменяется при мерцании */
    .lamp::after{
      content:'';
      position:absolute;
      left:40%;
      top:15%;
      width:550px;
      height:550px;
      transform:translate(-50%,-50%) scale(1);
      border-radius:50%;
      background:radial-gradient(circle at 50% 30%, rgba(255,230,170,0.9) 0%, rgba(255,200,100,0.5) 20%, rgba(255,160,50,0.18) 36%, rgba(0,0,0,0) 62%);
      filter:blur(12px) contrast(1.04);
      z-index:1; /* поверх картинки, но ниже контента */
      pointer-events:none;
      transition: transform 160ms ease, opacity 160ms ease, filter 160ms ease;
      opacity:0.95;
    }

    /* состояния мерцания */
    .lamp.flicker::after{ transform:translate(-50%,-50%) scale(0.96); opacity:0.72; filter:blur(8px) contrast(1.08) brightness(1.03); }
    .lamp.dim::after{ transform:translate(-50%,-50%) scale(0.82); opacity:0.28; filter:blur(22px) contrast(0.9) brightness(0.62); }
    .lamp.spark::after{ transform:translate(-50%,-50%) scale(1.12); opacity:1.12; filter:blur(6px) contrast(1.18) brightness(1.15); }

    /* предотвращаем какие-либо дополнительные декоративные элементы (ветер) */
    /* grid & snow remain if you want — particles removed */
    .grid-bg{position:fixed;inset:0;z-index:1;pointer-events:none}
    #snowCanvas{position:fixed;inset:0;z-index:2;display:block}

    .wrap{position:relative;z-index:6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px}

    .card{
      width:100%;
      max-width:1160px;
      border-radius:16px;
      padding:20px;
      background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 18px 60px rgba(0,0,0,0.7);
      backdrop-filter:blur(1px);
      display:grid;
      grid-template-columns:360px 1fr;
      gap:18px;
      align-items:start;
      overflow:hidden;
      position:relative;
    }

    .card::after{content:'';position:absolute;inset:0;border-radius:16px;padding:1px;background:linear-gradient(90deg,rgba(74,139,163,0.06),rgba(74,139,163,0.14) 50%,rgba(74,139,163,0.06));-webkit-mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);mask-composite:exclude;z-index:-1;animation:borderSlide 6s linear infinite}
    @keyframes borderSlide{0%{background-position:0% 50%}100%{background-position:200% 50%}}

    /* card footer (фикс внизу карточки) */
    .card-footer{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 10px;
      display: flex;
      justify-content: flex-end;
      padding: 0 18px;
      z-index: 8; /* над карточкой содержимым */
      pointer-events: none;
    }
    .card-footer .meta{
      pointer-events: auto;
      font-size:12px;
      opacity:0.7;
      text-align:right;
      color: rgba(207,230,247,0.9);
    }

    /* остальной стиль — без изменений */
    .profile{padding:22px;position:relative;z-index:2;display:flex;flex-direction:column;gap:16px;align-items:center}
    .avatar{
      /* чуть побольше, круглая форма */
      width: 152px;
      height: 152px;
      border-radius: 50%;
      overflow: hidden;

      /* сохраняем визуальные стили оригинала + мягкий голубой обод */
      border: 2px solid rgba(64,115,129,0.85);
      background: rgba(255,255,255,0.02);
      box-shadow:
        0 12px 30px rgba(0,0,0,0.6),
        inset 0 0 24px rgba(74,139,163,0.02),
        0 0 6px rgba(64,115,129,0.10),
        0 0 22px rgba(64,115,129,0.05);

      display: flex;
      align-items: center;
      justify-content: center;

      position: relative;
      z-index: 2;
      will-change: box-shadow;
      --avatar-glow-rgb: 64,115,129;
      /* если вы уже добавили анимацию avatarGlowPulse — она сохранится и будет работать */
      animation: avatarGlowPulse 1s ease-in-out infinite;
    }    
    @keyframes avatarGlowPulse {
      0% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 14px rgba(var(--avatar-glow-rgb),0.3),
          0 0 34px rgba(var(--avatar-glow-rgb),0.10);
      }
      14.3% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 27px rgba(var(--avatar-glow-rgb),0.4),
          0 0 62px rgba(var(--avatar-glow-rgb),0.2);
      }
      28.6% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 40px rgba(var(--avatar-glow-rgb),0.55),
          0 0 96px rgba(var(--avatar-glow-rgb),0.3);
      }
      42.9% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 54px rgba(var(--avatar-glow-rgb),0.7),
          0 0 120px rgba(var(--avatar-glow-rgb),0.45);
      }
      57.2% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 54px rgba(var(--avatar-glow-rgb),0.7),
          0 0 120px rgba(var(--avatar-glow-rgb),0.45);
      }
      71.5% {
        /* плавное возвращение света */
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 40px rgba(var(--avatar-glow-rgb),0.55),
          0 0 96px rgba(var(--avatar-glow-rgb),0.3);
      }
      85.8% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 27px rgba(var(--avatar-glow-rgb),0.4),
          0 0 62px rgba(var(--avatar-glow-rgb),0.2);
      }
      100% {
        box-shadow:
          0 12px 30px rgba(0,0,0,0.6),
          inset 0 0 24px rgba(74,139,163,0.02),
          0 0 14px rgba(var(--avatar-glow-rgb),0.3),
          0 0 34px rgba(var(--avatar-glow-rgb),0.10);
      }
    }
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .nick{font-weight:800;font-size:24px;color:var(--deep-blue-strong);text-align:center}
    .tag{font-weight:300;font-size:12px;opacity:0.6;margin-left:6px;padding:4px 8px;border-radius:8px;background:rgba(74,139,163,0.05)}
    .bio-text{color:rgba(207,230,247,0.92);line-height:1.5;text-align:center;font-size:14px;max-width:300px}

    .right{padding:18px;display:flex;flex-direction:column;gap:14px;z-index:2}
    .panels{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.015),rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);position:relative}
    .panel::before{content:'';position:absolute;left:0;top:0;width:100%;height:3px;background:linear-gradient(90deg,var(--soft-blue),var(--deep-blue))}
    .panel h4{margin:0 0 10px 0;font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--deep-blue-strong);display:flex;align-items:center;gap:8px}
    .skills{display:flex;gap:8px;flex-wrap:wrap}
    .skill-btn{padding:8px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--deep-blue-strong);cursor:pointer;font-weight:600}
    .skill-btn:hover{transform:translateY(-4px);background:rgba(64,116,130,0.05)}
    .music-controls{display:flex;gap:10px;align-items:center}.toggle-btn{padding:8px 12px;border-radius:10px;background:rgba(64,115,129,0.5);border:1px solid rgba(64,115,129,0.75);cursor:pointer}
    .progress{height:6px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden;flex:1;cursor:pointer;position:relative}.progress>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--soft-blue),var(--deep-blue));transition:width .12s linear}
    .links{display:flex;gap:10px;align-items:center}
    .social-link-telegram{
      width:140px;
      height:40px;
      padding: 0;
      border-radius:10px;
      display:flex;
      align-items:center;
      font-family: 'Inter', sans-serif; /* Тот же шрифт, что в .nick */
      font-weight: 800; /* Extrabold, как в нике */
      justify-content:center;
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      color: var(--deep-blue-strong);
      cursor:pointer;
      transition: transform .18s ease, background .18s ease, color .18s ease;
    }
    .social-link-telegram:hover{transform:translateY(-6px);background:rgba(64,116,130,0.07);color:var(--soft-blue)}
    .social-link-github{
      text-transform: none;
      width:125px;
      height:40px;
      padding:0;
      border-radius:10px;
      display:flex;
      align-items:center;
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      justify-content:center;
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      color:var(--deep-blue-strong);
      cursor:pointer;
      font-weight:700;
      transition: transform .18s ease, background .18s ease, color .18s ease;
    }
    .social-link-github:hover{transform:translateY(-6px);background:rgba(64,116,130,0.07);color:var(--soft-blue)}
    /* Discord button — выглядит и ведёт себя как .social-link */
    .discord-btn{
      width:120px;
      height:40px;
      padding:0;
      border-radius:10px;
      display:flex;
      align-items:center;
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      justify-content:center;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.04);
      color: var(--deep-blue-strong);
      cursor: pointer;
      font-weight:700;
      transition: transform .18s ease, background .18s ease, color .18s ease;
    }

    /* hover/active like the others */
    .discord-btn:hover{
      transform: translateY(-6px);
      background: rgba(64,116,130,0.07);
      color: var(--soft-blue);
    }

    /* немного фокуса для клавиатурной навигации */
    .discord-btn:focus{
      outline: 2px solid rgba(74,139,163,0.18);
      outline-offset: 3px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    }    .meta{font-size:14px;opacity:0.7;text-align:middle}

    .settings-toggle{position:fixed;right:18px;bottom:18px;z-index:9999;background:linear-gradient(180deg,var(--deep-blue),var(--soft-blue));color:#032;width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(0,0,0,0.6);cursor:pointer}
    .settings-panel{
      position:fixed;
      right:18px;
      bottom:86px;
      width:320px;
      background:rgba(10,12,15,0.05);
      border-radius:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.04);
      backdrop-filter:blur(3px);
      z-index:9998;
      display:none;
      flex-direction: column;
      gap:10px;
    }
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:rgba(0,0,0,0.7);color:#fff;padding:8px 12px;border-radius:8px;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:10000}
    @media(max-width:900px){.card{grid-template-columns:1fr;padding:16px}.profile{flex-direction:row;gap:12px;align-items:center}.bio-text{text-align:left;max-width:unset}.panels{grid-template-columns:1fr}.meta{text-align:center}.lamp{display:none}}

  /* ========================= MOBILE OVERRIDES: phones (~<=420px) =========================
     These rules preserve desktop behavior but change layout on phones:
     - Profile becomes stacked column (avatar centered above text)
     - Avatar size is increased for better visibility
     - Panels stack single-column and padding increased for touch
     - Coin/wheel controls moved inward for thumb reach
  ======================================================================================== */
  @media (max-width: 420px) {
    /* make card narrower and centered on phone */
    .wrap{padding:18px 12px;}
    .card {
      grid-template-columns: 1fr !important;
      max-width: 100%;
      padding: 20px !important;
      border-radius: 14px;
      gap: 24px;
    }

    /* STACK profile vertically and center */
    .profile {
      flex-direction: column !important;
      align-items: center !important;
      padding: 16px !important;
      gap: 16px !important;
    }

    /* Larger avatar on phones (close to sample) */
    .avatar {
      width: 140px !important;
      height: 140px !important;
      border-radius: 50% !important;
      border-width: 2px !important;
    }

    .nick {
      font-size: 24px !important;
      text-align: center !important;
      line-height: 1.2;
    }

    .bio-text {
      font-size: 16px !important;
      text-align: center !important;
      max-width: 100% !important;
      margin-top: 4px;
    }

    /* panels stack vertically and grow touch targets */
    .panels {
      grid-template-columns: 1fr !important;
      gap: 16px !important;
      padding: 12px 0;
    }
    .panel { padding: 16px !important; border-radius: 12px; }

    .icon_text { font-size: 22px !important;
      text-align: center !important;
      line-height: 1.1;
    }

    /* move coin & wheel inward so thumbs can reach */
    #coinCounter { right: 12px !important; bottom: 160px !important; padding:10px 12px; font-size: 18px; }
    #wheelBtn { right: 12px !important; bottom: 92px !important; width:56px; height:56px; border-radius:12px; font-size: 24px; }

    /* make audio controls comfortable on phone */
    .music-controls { gap:12px; flex-wrap:wrap; align-items:center; justify-content: center; }
    .toggle-btn { padding:12px 16px; font-size:16px; min-width: 48px; min-height: 48px; }
    .control-btn { padding:12px 16px; font-size:16px; min-width: 48px; min-height: 48px; }
    .playlist-btn { padding:12px 16px; font-size:16px; min-width: 48px; min-height: 48px; }

    /* footer to flow normally on phones */
    .card-footer { position: relative; bottom: 0; padding-top: 12px; justify-content: center; }

    /* reduce heavy background elements on phones for perf & clarity */
    .lamp, .page-bg, .grid-bg { display: none !important; }
    #snowCanvas { display: none !important; }

    /* ensure wheel modal fits nicely on phone */
    .wheelModal { width: calc(100% - 24px) !important; padding: 14px !important; }
    #wheel { width: 80vw !important; height: 80vw !important; }

    /* keep buttons tappable */
    .skill-btn, .btn-primary, .btn-ghost { padding: 12px 16px !important; font-size: 16px !important; border-radius: 12px !important; min-width: 48px; min-height: 48px; }

    /* social links larger on mobile */
    .social-link-telegram, .social-link-github, .discord-btn {
      height: 48px !important;
      font-size: 16px !important;
      padding: 0 16px !important;
      min-width: 120px;
    }

    /* aizen text centered and larger */
    .aizen-hypertext {
      font-size: 15px !important;
      text-align: center !important;
      margin-right: 0 !important;
      margin-bottom: 12px;
    }

    /* make the container column on mobile */
    .right > div[style*="display:flex;justify-content:space-between"] {
      flex-direction: column !important;
      align-items: center !important;
      gap: 16px !important;
    }

    /* playlist panel fits screen */
    .playlist-panel {
      width: 100% !important;
      max-height: 40vh !important;
      padding: 12px !important;
    }
    .playlist-item {
      padding: 14px 18px !important;
      font-size: 16px !important;
    }

    /* settings panel fits */
    .settings-panel {
      width: calc(100% - 40px) !important;
      right: 20px !important;
      padding: 16px !important;
    }
    .setting-row {
      font-size: 15px !important;
    }

    /* Hide coins, wheel, and related elements on mobile */
    #coinCounter, #wheelBtn, #wheelOverlay, .coin { display: none !important; }
  }

  /* small tweak also for narrow but larger phones */
  @media (min-width: 421px) and (max-width: 700px) {
    .avatar { width: 128px !important; height:128px !important; }
    .nick { font-size:22px !important; }
    #coinCounter { right: 12px !important; bottom: 140px !important; }
    #wheelBtn { right: 12px !important; bottom: 76px !important; }
    .card { padding: 18px !important; }
    .social-link-telegram, .social-link-github, .discord-btn { height: 44px !important; }
    .playlist-panel { width: 90% !important; }

    /* Hide coins, wheel, and related elements on mobile */
    #coinCounter, #wheelBtn, #wheelOverlay, .coin { display: none !important; }
  }

  /* Стили для кнопки плейлиста и списка треков */
  .playlist-btn {
    padding: 8px 12px;
    border-radius: 10px;
    background: rgba(64,115,129,0.5);
    border: 1px solid rgba(64,115,129,0.75);
    cursor: pointer;
    color: var(--deep-blue-strong);
    font-size: 14px;
    transition: transform .18s ease, background .18s ease;
  }
  .playlist-btn:hover {
    transform: translateY(-4px);
    background: rgba(64,115,129,0.7);
  }

  .playlist-panel {
    position: absolute;
    top: 100%; /* Ниже music-controls */
    left: 0;
    width: 400px;
    max-height: 200px; 
    overflow-y: scroll; 
    background: rgba(10,12,15,0.96);
    border-radius: 12px;
    padding: 16px; 
    border: 1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(8px);
    z-index: 10;
    display: none;
    flex-direction: column;
    gap: 12px; /*Увеличен зазор */
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    }
    .playlist-panel.open {
    display: flex; /* Убедитесь, что display: flex; для открытого состояния */
    }
    /* Дополнительно, чтобы скроллбар выглядел лучше (опционально, для WebKit браузеров) */
    .playlist-panel::-webkit-scrollbar {
    width: 8px;
    }
    .playlist-panel::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    }
    .playlist-panel::-webkit-scrollbar-thumb {
    background: rgba(64,115,129,0.5);
    border-radius: 10px;
    }
    .playlist-panel::-webkit-scrollbar-thumb:hover {
    background: rgba(64,115,129,0.8);
    }
    /* Для Firefox (опционально) */
    .playlist-panel {
    scrollbar-width: thin;
    scrollbar-color: rgba(64,115,129,0.5) rgba(255,255,255,0.05);
    }
    /* Дополнительно, чтобы скроллбар выглядел лучше (опционально, для WebKit браузеров) */
    .playlist-panel::-webkit-scrollbar {
    width: 8px;
    }
    .playlist-panel::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    }
    .playlist-panel::-webkit-scrollbar-thumb {
    background: rgba(64,115,129,0.5);
    border-radius: 10px;
    }
    .playlist-panel::-webkit-scrollbar-thumb:hover {
    background: rgba(64,115,129,0.8);
    }
  .playlist-item {
    padding: 12px 16px; /* Увеличено */
    border-radius: 10px; /* Слегка увеличено */
    background: rgba(255,255,255,0.02);
    color: var(--deep-blue-strong);
    cursor: pointer;
    transition: background .18s ease, transform .18s ease;
    font-size: 15px; /* Увеличен шрифт */
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .playlist-item:hover {
    background: rgba(64,116,130,0.07);
    transform: translateY(-2px);
  }
  .playlist-item.selected {
    background: rgba(64,115,129,0.5);
    font-weight: 700;
  }

  /* Новые стили для дополнительных кнопок управления */
  .control-btn {
    padding: 8px 12px;
    border-radius: 10px;
    background: rgba(64,115,129,0.5);
    border: 1px solid rgba(64,115,129,0.75);
    cursor: pointer;
    color: var(--deep-blue-strong);
    font-size: 14px;
    transition: transform .18s ease, background .18s ease;
  }
  .control-btn:hover {
    transform: translateY(-4px);
    background: rgba(64,115,129,0.7);
  }
  .control-btn.active {
    background: rgba(64,115,129,0.8);
    color: #fff;
  }
  .aizen-hypertext a {
    text-decoration: none;
    color: inherit;
    transition: transform .18s ease, background .18s ease, color .18s ease;
  }
  .aizen-hypertext a:hover {
    transform: translateY(-4px);
    background: rgba(64,116,130,0.07);
    color: var(--soft-blue);
    text-decoration: underline;
  }

</style>
</head>
<body>
  <div class="page-bg"></div>
  <!-- lamp-post background (локальная картинка) -->
  <div class="lamp" id="lampBg" aria-hidden="true"></div>

  <div class="grid-bg" aria-hidden="true"></div>
  <canvas id="snowCanvas"></canvas>

  <div class="wrap">
    <main class="card">
      <section class="profile">
        <div class="avatar"><img src="avatar.jpg" alt="avatar"></div>
        <div>
          <div class="nick">paranoct <span class="tag">• bio</span></div>
          <p class="bio-text">Привет! Я изучаю информационную безопасность и в комплекте с ней python и C++. Надеюсь смогу стать призёром заключительного этапа ВСОШ.</p>
        </div>
      </section>

      <section class="right">
        <div class="panels">
          <div class="panel">
            <h4><i class="fas fa-code"></i> Навыки</h4>
            <div class="skills">
              <button class="skill-btn" data-skill="Python">Python</button>
              <button class="skill-btn" data-skill="C++">C++</button>
              <button class="skill-btn" data-skill="InfoSec">InfoSec</button>
            </div>
          </div>

          <div class="panel">
            <h4><i class="fas fa-music"></i> Музыка</h4>
            <div class="music-controls" style="position: relative;">
              <button class="control-btn" id="prevBtn" title="Предыдущий трек"><i class="fas fa-step-backward"></i></button>
              <button class="toggle-btn" id="toggleBtn">▶</button>
              <button class="control-btn" id="nextBtn" title="Следующий трек"><i class="fas fa-step-forward"></i></button>
              <button class="control-btn" id="loopBtn" title="Повтор (loop)"><i class="fas fa-repeat"></i></button>
              <div id="currentTrackTitle">Тёмный принц - Овердоз</div>
              <button class="playlist-btn" id="playlistBtn" title="Выбрать трек">
                <i class="fas fa-list-ul" style="color: #000;"></i>
              </button>
              <!-- Панель плейлиста -->
              <div class="playlist-panel" id="playlistPanel">
                <!-- Треки добавляются динамически через JS -->
              </div>
            </div>
            <div style="margin-top:10px;display:flex;align-items:center;gap:10px">
              <div class="progress" id="prog"><i></i></div>
              <div style="font-size:12px;opacity:0.75;width:90px;text-align:right" id="timeLabel">00:00 / 00:00</div>
            </div>
            <audio id="audio" src="temnyy_princ_overdoz.mp3"></audio>

            <h4 style="margin-top:18px"><i class="fas fa-link"></i> Ссылки</h4>
            <div class="links" style="margin-top:8px">
              <a href="https://github.com/paranoct" style="text-decoration: none;" class="social-link-github" title="GitHub">
                <i class="fab fa-github"></i> <p>GitHub</p>
              </a>
              <a href="https://t.me/korben_322" style="text-decoration: none;" class="social-link-telegram" title="Telegram ">
                <i class="fab fa-telegram"></i> <p>Telegram</p>
            </a>

              <!-- DISCORD BUTTON: копирует ник "paranoct" -->
              <button id="discordBtn" class="discord-btn" title="Копировать ник в Discord"> 
                <i class="fab fa-discord"></i> <p>Discord</p>
              </button>
            </div>
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="aizen-hypertext" style="font-size:14px;opacity:0.8;margin-right:20px"><a href="aizen.html">«Изначально никто не живёт на небесах: ни ты, ни я, ни даже Бог. 
            Но скоро пустое место на небесном троне, которое так грустно видеть, будет занято. Отныне я буду жить на небесах»</a></div>
          <!-- мета перемещена в card-footer -->
        </div>
      </section>

      <!-- footer fixed to bottom of the main card -->
      <div class="card-footer" aria-hidden="false">
        <div class="meta">&copy; 2025 paranoct • All rights reserved</div>
      </div>

    </main>
  </div>

  <!-- === монетки и кнопка колеса фортуны === -->
  <div id="coinCounter" aria-hidden="false" title="Монетки">
    <i class="fas fa-coins" aria-hidden="true"></i>
    <span id="coinCount">0</span>
  </div>

  <!-- кнопка открытия колеса (видна как квадратная иконка) -->
  <div id="wheelBtn" title="Колесо фортуны (1 монета)">
    <i class="fas fa-dharmachakra"></i>
  </div>

  <!-- overlay / модал колеса фортуны -->
  <div id="wheelOverlay" aria-hidden="true">
    <div class="wheelModal" role="dialog" aria-modal="true">
      <div class="wheelWrap">
        <div class="wheelPointer" aria-hidden="true"></div>

        <!-- Визуальная часть колеса (фон/градиент в CSS) -->
        <div id="wheel" aria-hidden="true"></div>

        <div class="wheel-controls">
          <button class="btn-ghost" id="closeWheel">Закрыть</button>
          <button class="btn-primary" id="spinBtn">Крутить (1 монета)</button>
        </div>

        <div id="wheelResult" aria-live="polite" style="margin-top:10px; min-height:22px; color:#dfefff; font-weight:700"></div>
      </div>
    </div>
  </div>
  <!-- === === /монетки и колесо === -->

  <div class="settings-toggle" id="settingsToggle" title="Настройки (S — снег, Space — play/pause, M — mute)">
    <i class="fas fa-cog"></i>
  </div>
  <div class="settings-panel" id="settingsPanel" aria-hidden="true">
    <h4>Настройки</h4>
    <div class="setting-row">
      <div style="width:240px;font-size:13px">Громкость (осторожно, громко)</div>
      <input type="range" id="volRange" class="range" min="0" max="1" step="0.01" />
      <div id="volVal" style="width:40px;text-align:right">3%</div>
    </div>
    <div class="setting-row">
      <div style="width:160px;font-size:13px">Прозрачность снега</div>
      <input type="range" id="snowOpacity" class="range" min="0.4" max="0.9" step="0.005" />
      <div id="snowOpVal" style="width:40px;text-align:right"></div>
    </div>
    <div class="setting-row">
      <div style="width:120px;font-size:13px">Плотность снега</div>
      <input type="range" id="snowDensity" class="range" min="1" max="20" step="1" />
      <div id="snowDenVal" style="width:40px;text-align:right"></div>
    </div>
    <div class="setting-row" style="display:flex;align-items:center;gap:8px">
      <div style="flex:1;font-size:13px">Спавн монеток</div>
      <input type="checkbox" id="spawnCoinsToggle" checked />
    </div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <div class="kbd">Space</div><div style="opacity:0.8">play/pause</div>
      <div style="flex:1"></div>
      <div class="kbd">S</div><div style="opacity:0.8">вкл/выкл снег</div>
    </div>
  </div>

  <div class="toast" id="toast">Скопировано</div>

  <script>
    // Мерцание лампы: только ореол/яркость меняются, фото остаётся непрозрачным
    const lamp = document.getElementById('lampBg');
    (function lampFlicker(){
      function trigger(){
        const r = Math.random();
        if(r < 0.06){ lamp.classList.add('dim'); setTimeout(()=> lamp.classList.remove('dim'), 300 + Math.random()*900); }
        else if(r < 0.34){ lamp.classList.add('flicker'); setTimeout(()=> lamp.classList.remove('flicker'), 80 + Math.random()*180); }
        else if(r > 0.986){ lamp.classList.add('spark'); setTimeout(()=> lamp.classList.remove('spark'), 90 + Math.random()*220); }
        setTimeout(trigger, 200 + Math.random()*1000);
      }
      trigger();
    })();

    // СНЕГ: простой canvas-эффект — включаем сразу при загрузке
    const canvas = document.getElementById('snowCanvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = innerWidth; let h = canvas.height = innerHeight;
    let densityMultiplier = 10.0; let flakes = []; let snowEnabled = true; let globalAlphaMultiplier = 1.0;
    function rand(a,b){return Math.random()*(b-a)+a}
    function generateFlakes(){ const base = Math.floor((w*h)/38000); const COUNT = Math.max(6, Math.floor(base * densityMultiplier)); flakes.length=0; for(let i=0;i<COUNT;i++) flakes.push({x:Math.random()*w,y:Math.random()*h,r:rand(0.6,2.2),speed:rand(0.2,0.9),baseAlpha:rand(0.005,0.03)}); }
    generateFlakes(); addEventListener('resize', ()=>{w=canvas.width=innerWidth;h=canvas.height=innerHeight;generateFlakes()});
    function draw(){ ctx.clearRect(0,0,w,h); if(!snowEnabled){ requestAnimationFrame(draw); return } for(let i=0;i<flakes.length;i++){const f=flakes[i];ctx.beginPath();const alpha=Math.max(0,Math.min(1,f.baseAlpha*globalAlphaMultiplier));ctx.fillStyle='rgba(255,255,255,'+alpha+')';ctx.arc(f.x,f.y,f.r,0,Math.PI*2);ctx.fill();f.y+=f.speed;f.x+=Math.sin(f.y*0.01+i)*0.4;if(f.y>h+6){f.y=-10;f.x=Math.random()*w}}requestAnimationFrame(draw)}
    draw();

    // UI: toast & copy logic
    const toast = document.getElementById('toast'); let toastTimer=null;
    function showToast(text, ms = 1600){
      toast.textContent = text;
      toast.style.opacity = '1';
      if(toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ toast.style.opacity = '0'; }, ms);
    }

    // skill buttons copy
    document.querySelectorAll('.skill-btn').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const s = btn.dataset.skill || btn.textContent.trim();
        try{ await navigator.clipboard.writeText(s); showToast(`Скопировано: ${s}`); } catch(e){ showToast('Нельзя скопировать автоматически'); }
        btn.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:260});
      });
    });

    // DISCORD button: копирует ник "paranoct"
    const discordBtn = document.getElementById('discordBtn');
    if (discordBtn) {
      discordBtn.addEventListener('click', async () => {
        const nick = 'paranoct';
        try {
          await navigator.clipboard.writeText(nick);
          if (typeof showToast === 'function') showToast(`Скопировано: ${nick}`);
          else alert(`Скопировано: ${nick}`);
        } catch (e) {
          if (typeof showToast === 'function') showToast('Не получилось скопировать');
          else alert('Не удалось скопировать');
        }
        discordBtn.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 220 });
      });
    }

    // AUDIO controls
    const audio=document.getElementById('audio');audio.volume=0.007;
    const toggleBtn=document.getElementById('toggleBtn');const progBar=document.getElementById('prog');const progFill=progBar.querySelector('i');const timeLabel=document.getElementById('timeLabel');
    function updateBtn(){toggleBtn.textContent=audio.paused?'▶':'⏸'}
    toggleBtn.addEventListener('click',()=>{ if(audio.paused) audio.play(); else audio.pause(); updateBtn(); });
    audio.addEventListener('play',updateBtn); audio.addEventListener('pause',updateBtn);
    audio.addEventListener('timeupdate',()=>{ if(!audio.duration||isNaN(audio.duration)) return; const pct=(audio.currentTime/audio.duration)*100; progFill.style.width=pct+'%'; timeLabel.textContent=formatTime(audio.currentTime)+' / '+formatTime(audio.duration) });
    function formatTime(s){ if(!s||isNaN(s)) return '00:00'; const m=Math.floor(s/60); const sec=Math.floor(s%60); return String(m).padStart(2,'0')+':'+String(sec).padStart(2,'0'); }
    progBar.addEventListener('click',(e)=>{ if(!audio.duration) return; const rect=progBar.getBoundingClientRect(); const x=e.clientX-rect.left; audio.currentTime=Math.max(0,Math.min(1,x/rect.width))*audio.duration; });

    // SETTINGS UI
    const settingsToggle=document.getElementById('settingsToggle');const settingsPanel=document.getElementById('settingsPanel');
    settingsToggle.addEventListener('click',()=>{ const show=settingsPanel.style.display!=='flex'; settingsPanel.style.display=show?'flex':'none'; settingsPanel.setAttribute('aria-hidden',show?'false':'true'); });

    const volRange=document.getElementById('volRange');
    const volVal=document.getElementById('volVal');
    volRange.value=audio.volume;
    volVal.textContent=Math.round((Number(audio.volume).toFixed(2)*100)) + "%";
    volRange.addEventListener('input',()=>{ 
      audio.volume=Number(volRange.value); 
      volVal.textContent=Math.round((Number(audio.volume).toFixed(2)*100)) + "%"; 
    });

    // SNOW settings: задаём значение сразу, чтобы снег был виден при загрузке
    const snowOpacity = document.getElementById('snowOpacity');
    const snowOpVal = document.getElementById('snowOpVal');
    // Значение по умолчанию — 0.6 (в пределах 0.4..0.9 установленного слайдера)
    snowOpacity.value = 0.9;
    globalAlphaMultiplier = 0.9 / 0.03; // сразу применяем прозрачность
    snowOpacity.addEventListener('input', ()=>{
      const v = Number(snowOpacity.value);
      globalAlphaMultiplier = v / 0.03;
    });

    const snowDensity=document.getElementById('snowDensity');
    const snowDenVal=document.getElementById('snowDenVal');
    snowDensity.value = 20.0; 
    densityMultiplier = Number(snowDensity.value);
    generateFlakes();

    snowDensity.addEventListener('input', ()=>{ 
      densityMultiplier = Number(snowDensity.value); 
      generateFlakes(); 
    });

    function toggleSnow(){ snowEnabled = !snowEnabled; showToast(snowEnabled ? 'Снег включён' : 'Снег отключён'); }

    // hotkeys
    window.addEventListener('keydown',(e)=>{
      if(e.code==='Space'){ e.preventDefault(); if(audio.paused) audio.play(); else audio.pause(); updateBtn(); }
      if(e.key==='s'||e.key==='S'){ toggleSnow(); }
      if(e.key==='m'||e.key==='M'){ audio.muted = !audio.muted; showToast(audio.muted ? 'Звук выключён' : 'Звук включён'); }
      if(e.key==='Escape'){ settingsPanel.style.display = 'none'; }
    });

    // click outside settings closes it
    document.addEventListener('click',(e)=>{ if(!settingsPanel.contains(e.target) && !settingsToggle.contains(e.target)){ if(settingsPanel.style.display === 'flex') settingsPanel.style.display = 'none'; } });
    

  (function(){
  // state + localStorage
  const STORAGE_KEY = 'paranoct_coins';
  const SPAWN_ENABLED_KEY = 'spawnCoinsEnabled';
  let coins = 0;
  const coinCountEl = document.getElementById('coinCount');
  const coinCounterEl = document.getElementById('coinCounter');
  const wheelBtn = document.getElementById('wheelBtn');
  const wheelOverlay = document.getElementById('wheelOverlay');
  const wheelEl = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const closeWheel = document.getElementById('closeWheel');
  const wheelResult = document.getElementById('wheelResult');
  let spawnEnabled = true;

  let spinning = false; // блокировка выхода во время прокрутки

  function loadCoins(){
    const v = parseInt(localStorage.getItem(STORAGE_KEY));
    coins = isNaN(v) ? 0 : v;
    const enabled = localStorage.getItem(SPAWN_ENABLED_KEY);
    spawnEnabled = enabled !== '0';
    const spawnToggle = document.getElementById('spawnCoinsToggle');
    if(spawnToggle) spawnToggle.checked = spawnEnabled;
  }
  function saveCoins(){ localStorage.setItem(STORAGE_KEY, String(coins)); }

  loadCoins();

  // helper UI update
  function updateCoinUI(){
    if(coinCountEl) coinCountEl.textContent = coins;
    if(coinCounterEl) coinCounterEl.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}],{duration:220});
    saveCoins();
  }

  function showToastLocal(text){
    if(typeof showToast === 'function') showToast(text);
    else {
      const t = document.createElement('div');
      t.textContent = text;
      t.style.position='fixed'; t.style.left='50%'; t.style.bottom='22px'; t.style.transform='translateX(-50%)';
      t.style.background='rgba(0,0,0,0.7)'; t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='8px'; t.style.zIndex=10005;
      document.body.appendChild(t);
      setTimeout(()=> t.style.opacity='0', 1400);
      setTimeout(()=> t.remove(), 2000);
    }
  }

  // spawn coin (avoid UI zones)
  function spawnCoin(){
    const coin = document.createElement('div');
    coin.className = 'coin spawn-anim';
    coin.textContent = '¢';

    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

    // collect exclusion rects (settings, panel, wheel button, coinCounter, main card and its parts)
    const exclusionEls = [
      document.getElementById('settingsToggle'),
      document.getElementById('settingsPanel'),
      wheelBtn,
      coinCounterEl,
      document.querySelector('main.card'),
      document.querySelector('.right'),
      document.querySelector('.profile'),
      document.querySelector('.card-footer')
    ];
    const exclusionRects = exclusionEls.reduce((acc, el) => {
      try {
        if(el && typeof el.getBoundingClientRect === 'function') acc.push(el.getBoundingClientRect());
      } catch(e){}
      return acc;
    }, []);

    // try multiple attempts to find non-overlapping position
    let x = 40, y = 120, attempt = 0;
    while(attempt < 80){
      const leftMargin = 20;
      const topMargin = 60;
      const marginRight = vw < 420 ? 60 : 220; // меньше на мобильных
      const bottomMargin = vh < 600 ? 180 : 140; // больше на мобильных для избежания низа
      x = Math.floor(Math.random() * Math.max(20, vw - marginRight - 80)) + leftMargin;
      y = Math.floor(Math.random() * Math.max(20, vh - bottomMargin)) + topMargin;

      const rect = { left: x, right: x + 44, top: y, bottom: y + 44 };
      const overlap = exclusionRects.some(r => !(rect.right < r.left || rect.left > r.right || rect.bottom < r.top || rect.top > r.bottom));
      if(!overlap) break;
      attempt++;
    }

    // if we failed to find a non-overlapping spot, nudge coin to top-left safe area
    if(attempt >= 80){
      x = 24;
      y = 100;
    }

    coin.style.left = x + 'px';
    coin.style.top = y + 'px';
    coin.style.opacity = '0.92';
    document.body.appendChild(coin);

    const autoRem = setTimeout(()=>{ if(coin.parentNode) coin.remove(); }, 120000);

    // Prevent double-collect: mark immediately on pointerdown/click
    function collectOnce(e){
      e.stopPropagation();
      // if already collected, ignore
      if(coin.dataset.collected) return;
      coin.dataset.collected = '1';
      clearTimeout(autoRem);
      // make non-interactive immediately
      coin.style.pointerEvents = 'none';
      coin.style.transform = 'scale(1.4) translateY(-8px)';
      coin.style.opacity = '0';
      setTimeout(()=> { try{ coin.remove(); } catch(e){} }, 260);
      coins += 1;
      updateCoinUI();
      showToastLocal('Монетка собрана +1');
    }

    // attach both pointerdown and click to be robust; pointerdown is first and ensures dataset is set early
    coin.addEventListener('pointerdown', collectOnce, { once: true });
    // fallback click in case pointerdown not fired
    coin.addEventListener('click', collectOnce);
  }

  // initial spawn + interval
  if (spawnEnabled) spawnCoin();
  const spawnInterval = 360000;
  setInterval(()=>{ if (spawnEnabled) spawnCoin(); }, spawnInterval);

  // spawn toggle handler
  const spawnToggle = document.getElementById('spawnCoinsToggle');
  if (spawnToggle) {
    spawnToggle.addEventListener('change', () => {
      spawnEnabled = spawnToggle.checked;
      localStorage.setItem(SPAWN_ENABLED_KEY, spawnEnabled ? '1' : '0');
      showToastLocal(spawnEnabled ? 'Спавн монеток включён' : 'Спавн монеток отключён');
    });
  }

  // wheel labels and spin logic
  const labels = [
    'Как дела?',
    'Привет!',
    '2 монеты',
    'Проверь директорию /secret/secret.html Вдруг там что-то интересное?'
  ];
  const segmentCount = labels.length;
  const segmentSize = 360 / segmentCount;

  // ---- REPLACED: robust spin logic with pointer at TOP (12 o'clock) ----
  // Pointer at TOP corresponds to POINTER_ANGLE = 270 (in conic-gradient coordinates: 0deg = right)
  const POINTER_ANGLE = 90;

  function debugLogIdx(totalDeg){
    const norm = ((totalDeg % 360) + 360) % 360;
    const angleAtPointer = (POINTER_ANGLE - norm + 360) % 360;
    const idx = Math.floor(angleAtPointer / segmentSize) % segmentCount;
    console.log({ totalDeg, norm, angleAtPointer, idx, label: labels[idx] });
    return idx;
  }

  function spinWheel(){
    if (spinning) return; // ещё крутится
    if (coins < 1) { showToastLocal('Нужно 1 монетка, чтобы крутить'); return; }
    coins -= 1; updateCoinUI();
    spinning = true;
    if(spinBtn){ spinBtn.disabled = true; spinBtn.textContent = 'Крутится...'; }
    if(closeWheel) closeWheel.disabled = true;
    if(wheelResult) wheelResult.textContent = '';

    const fullSpins = Math.floor(Math.random() * 4) + 5;
    const finalAngle = Math.floor(Math.random() * 360);
    const totalDeg = fullSpins * 360 + finalAngle;
    const ANIM_DURATION_MS = 5000;

    if(wheelEl){
      wheelEl.style.transition = `transform ${ANIM_DURATION_MS/1000}s cubic-bezier(.14,.9,.36,1)`;
      void wheelEl.offsetWidth; // force reflow
      wheelEl.style.transform = `rotate(${totalDeg}deg)`;
    }

    let finished = false;
    function finishSpin(){
      if(finished) return;
      finished = true;
      const norm = ((totalDeg % 360) + 360) % 360;
      const angleAtPointer = (POINTER_ANGLE - norm + 360) % 360;
      let idx = Math.floor(angleAtPointer / segmentSize) % segmentCount;
      if(idx < 0) idx = 0;
      const result = labels[idx] || '—';
      if(wheelResult) wheelResult.textContent = 'Результат: ' + result;

      if(result.includes('2 монеты')) { coins += 2; updateCoinUI(); showToastLocal('+2 монетки!'); }
      else if(result.includes('10 XP')) { showToastLocal('Получено 10 XP'); }

      if(spinBtn){ spinBtn.disabled = false; spinBtn.textContent = 'Крутить (1 монета)'; }
      if(closeWheel) closeWheel.disabled = false;
      spinning = false;
    }

    function onEnd(e){
      if(e && e.propertyName && e.propertyName !== 'transform') return;
      if(wheelEl) wheelEl.removeEventListener('transitionend', onEnd);
      clearTimeout(fallbackTimer);
      finishSpin();
    }
    if(wheelEl) wheelEl.addEventListener('transitionend', onEnd);
    const fallbackTimer = setTimeout(()=> {
      try { if(wheelEl) wheelEl.removeEventListener('transitionend', onEnd); } catch(e){}
      finishSpin();
    }, ANIM_DURATION_MS + 120);
  }
  // ---- END REPLACED ----

  // open/close handlers
  if(wheelBtn){
    wheelBtn.addEventListener('click', ()=> {
      if(!wheelOverlay) return;
      wheelOverlay.classList.add('open');
      wheelOverlay.setAttribute('aria-hidden','false');
      if(wheelEl){ wheelEl.style.transition = 'none'; wheelEl.style.transform = 'rotate(0deg)'; }
      if(wheelResult) wheelResult.textContent = '';
    });
  }

  if(closeWheel){
    closeWheel.addEventListener('click', ()=> {
      if(spinning){
        showToastLocal('Нельзя закрыть, пока колесо крутится');
        return;
      }
      if(wheelOverlay){ wheelOverlay.classList.remove('open'); wheelOverlay.setAttribute('aria-hidden','true'); }
    });
  }

  if(spinBtn) spinBtn.addEventListener('click', spinWheel);

  if(wheelOverlay) wheelOverlay.addEventListener('click', (e) => {
    // clicking the dim background closes only if not spinning and target is overlay itself
    if (e.target === wheelOverlay) {
      if(spinning){
        showToastLocal('Нельзя выйти во время прокрутки');
        return;
      }
      wheelOverlay.classList.remove('open');
      wheelOverlay.setAttribute('aria-hidden','true');
    }
  });

  // prevent navigation/escape close while spinning: intercept before potential handlers
  document.addEventListener('keydown', (e) => {
    if((e.key === 'Escape' || e.key === 'Esc') && spinning){
      // prevent accidental closing
      e.stopImmediatePropagation();
      e.preventDefault();
      showToastLocal('Нельзя закрыть, пока колесо крутится');
    }
  }, true); // capture phase to block earlier handlers

  // initial UI sync
  updateCoinUI();

  // debug API
  window.__gameCoins = {
    get: ()=>coins,
    add: (n)=>{ coins += n; updateCoinUI(); }
  };
})();

  // small mobile-friendly tweak: if phone detected, reduce snow and slightly adjust coin spawn
  (function(){
    const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
    const isMobile = isTouch || window.matchMedia('(max-width:700px)').matches;
    if(isMobile){
      try{
        densityMultiplier = Math.max(4, Math.min(8, densityMultiplier));
        generateFlakes();
        globalAlphaMultiplier = Math.min(globalAlphaMultiplier, 6);
        snowEnabled = false; // отключить снег на мобильных для производительности
      }catch(e){}
      try{
        const coin = document.getElementById('coinCounter'); const wheel = document.getElementById('wheelBtn');
        const wheelOverlay = document.getElementById('wheelOverlay');
        if(coin) coin.style.display = 'none';
        if(wheel) wheel.style.display = 'none';
        if(wheelOverlay) wheelOverlay.style.display = 'none';
      }catch(e){}
      // Disable spawning on mobile
      spawnEnabled = false;
      const spawnToggle = document.getElementById('spawnCoinsToggle');
      if(spawnToggle) spawnToggle.checked = false;
    }
  })();

  // Плейлист логика
  (function(){
    const tracks = [
      { title: 'Тёмный принц - Овердоз', src: 'temnyy_princ_overdoz.mp3', duration: null },
      { title: 'Тёмный принц - ПАПА', src: 'PAPA.mp3', duration: null },
      { title: 'KSB Music - Баратрум', src: 'bara.mp3', duration: null },
      { title: 'KSB Music - Я вытащу тебя со дна', src: 'so_dna.mp3', duration: null },
      { title: 'KSB Music - На урсе', src: 'na_urse.mp3', duration: null },
      { title: 'Drowning Love', src: 'edit_aizen.mp3', duration: null},
      { title: 'zxcursed, interworld - Metamarphosis 3', src: 'meta3.mp3', duration: null},
      { title: 'Серега Пират - АМ ФП', src: 'AMFP.mp3', duration: null},
      { title: 'Лида, Серега Пират - ЧСВ', src: 'CHSV.mp3', duration: null},
      { title: 'Серега Пират - Тильт', src: 'TILT.mp3', duration: null},
      { title: "Napoleon's song - Amour Plastique", src: 'napoleon.mp3', duration: null},
      { title: 'Серега Пират - И я кричу остановите катку!', src: 'KATKA.mp3', duration: null}
    ];
    let currentTrackIndex = 0;
    let isLoop = false;

    const playlistBtn = document.getElementById('playlistBtn');
    const playlistPanel = document.getElementById('playlistPanel');
    const currentTrackTitle = document.getElementById('currentTrackTitle');
    const loopBtn = document.getElementById('loopBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Функция для загрузки и воспроизведения трека
    function loadAndPlayTrack(index) {
      currentTrackIndex = index;
      audio.src = tracks[index].src;
      audio.load();
      audio.play().then(() => {
        updateBtn();
        currentTrackTitle.textContent = tracks[index].title;
        document.querySelectorAll('.playlist-item').forEach(item => item.classList.remove('selected'));
        document.querySelector(`.playlist-item[data-index="${index}"]`).classList.add('selected');
      }).catch(err => console.error('Ошибка воспроизведения:', err));
    }

    // Обновление отображения длительности в плейлисте
    function updatePlaylistItemDuration(index, duration) {
      const item = document.querySelector(`.playlist-item[data-index="${index}"]`);
      if (item) {
        const durationSpan = item.querySelector('.duration');
        if (!durationSpan) {
          const span = document.createElement('span');
          span.className = 'duration';
          span.style.opacity = '0.7';
          span.style.fontSize = '13px';
          item.appendChild(span);
        }
        item.querySelector('.duration').textContent = formatTime(duration);
      }
    }

    // Асинхронная загрузка длительности треков
    tracks.forEach((track, index) => {
      const tempAudio = new Audio(track.src);
      tempAudio.addEventListener('loadedmetadata', () => {
        tracks[index].duration = tempAudio.duration;
        updatePlaylistItemDuration(index, tempAudio.duration);
        // Если это текущий трек, обновляем timeLabel
        if (index === currentTrackIndex) {
          timeLabel.textContent = '00:00 / ' + formatTime(tempAudio.duration);
        }
      });
    });

    // Создаём список треков динамически
    tracks.forEach((track, index) => {
      const item = document.createElement('div');
      item.className = 'playlist-item';
      item.innerHTML = `<div style="display: flex; align-items: center; gap: 16px;"><span>${index + 1}</span><span>${track.title}</span></div><span class="duration" style="opacity:0.7; font-size:13px;">--:--</span>`;
      item.dataset.index = index;
      if (index === currentTrackIndex) item.classList.add('selected');
      playlistPanel.appendChild(item);
    });

    // Toggle плейлиста
    playlistBtn.addEventListener('click', () => {
      playlistPanel.classList.toggle('open');
    });

    // Выбор трека
    playlistPanel.addEventListener('click', (e) => {
      if (e.target.closest('.playlist-item')) {
        const index = parseInt(e.target.closest('.playlist-item').dataset.index);
        loadAndPlayTrack(index);
        playlistPanel.classList.remove('open');
      }
    });

    // Закрытие плейлиста при клике вне
    document.addEventListener('click', (e) => {
      if (!playlistPanel.contains(e.target) && !playlistBtn.contains(e.target)) {
        playlistPanel.classList.remove('open');
      }
    });

    // Дополнительные кнопки: prev, next, loop
    prevBtn.addEventListener('click', () => {
      const prevIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
      loadAndPlayTrack(prevIndex);
    });

    nextBtn.addEventListener('click', () => {
      const nextIndex = (currentTrackIndex + 1) % tracks.length;
      loadAndPlayTrack(nextIndex);
    });

    loopBtn.addEventListener('click', () => {
      isLoop = !isLoop;
      loopBtn.classList.toggle('active', isLoop);
    });

    // Автоматический переход на следующий трек или повтор
    audio.addEventListener('ended', () => {
      if (isLoop) {
        audio.play();
      } else {
        const nextIndex = (currentTrackIndex + 1) % tracks.length;
        loadAndPlayTrack(nextIndex);
      }
    });

    // Инициализация
    currentTrackTitle.textContent = tracks[currentTrackIndex].title;
    audio.src = tracks[currentTrackIndex].src;
    // Загружаем duration для первого трека сразу
    audio.addEventListener('loadedmetadata', () => {
      tracks[currentTrackIndex].duration = audio.duration;
      updatePlaylistItemDuration(currentTrackIndex, audio.duration);
      timeLabel.textContent = '00:00 / ' + formatTime(audio.duration);
    });
  })();

</script>
</body>
</html>
